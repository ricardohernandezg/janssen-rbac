/*
init script must
- put the config file template

prepare script must
- get the settings from rbac config and general config
- connect to database and create the tables if not exists
- if exists, must check that structure has the required fields or offer to add them

*/

$DS = (strtoupper(substr(PHP_OS, 0, 3)) === 'WIN')?'\\':'/';

$files = [
    'app' => [
        'QWRtaW5HdWFyZC5waHA=$YXBwL0F1dGg=$PD9waHAgDQoNCm5hbWVzcGFjZSBBcHBcQXV0aDsNCg0KdXNlIEphbnNzZW5cSGVscGVyc1xHdWFyZDsNCnVzZSBKYW5zc2VuXEVuZ2luZVxSZXF1ZXN0Ow0KDQpjbGFzcyBBZG1pbkd1YXJkIGV4dGVuZHMgR3VhcmQNCnsNCg0KICAgIC8qKg0KICAgICAqIE1ha2UgdGhlIGF1dGhlbnRpY2F0aW9uIG9mIGEgdXNlciB0aHJvdWdoIHRoZSBBZG1pbiBHdWFyZC4NCiAgICAgKiBUaGlzIHdpbGwgZ3JhbnQgYSByZXF1ZXN0IGNvbWVzIGZyb20gYSB1c2VyIHRoYXQgaXMgaW4gdGhlIA0KICAgICAqIGxpc3QgdGhhdCBjYW4gYWNjZXNzIHRoZSByZXNvdXJjZSBtYW5hZ2VkIGJ5IEFkbWluDQogICAgICoNCiAgICAgKiBAcGFyYW0gUmVxdWVzdCAkcmVxdWVzdA0KICAgICAqIEByZXR1cm4gdm9pZA0KICAgICAqLw0KICAgIHB1YmxpYyBmdW5jdGlvbiBhdXRoZW50aWNhdGUoUmVxdWVzdCAkcmVxdWVzdCkNCiAgICB7DQogICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEF1dGhvcml6ZSBhbiBhY3Rpb24gdGhhdCBtdXN0IGNvbWUgZnJvbSBhbiBhdXRoZW50aWNhdGVkIHVzZXINCiAgICAgKiBhcyB0aGUgcm91dGUgc2hvdWxkIGJlIHByb3RlY3RlZCB3aXRoIHRoaXMgZ3VhcmQNCiAgICAgKg0KICAgICAqIEBwYXJhbSBSZXF1ZXN0ICRyZXF1ZXN0DQogICAgICogQHJldHVybiB2b2lkDQogICAgICovDQogICAgcHVibGljIGZ1bmN0aW9uIGF1dGhvcml6ZShSZXF1ZXN0ICRyZXF1ZXN0KQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIHRydWU7DQogICAgfQ0KICAgIA0KfQ==',
        'ZW5naW5lLnBocA==$YXBwL0NvbmZpZw==$PD9waHANCg0KdXNlIEphbnNzZW5cRW5naW5lXENvbmZpZzsNCg0KcmV0dXJuIFsNCiAgICAncHJlcHJvY2Vzc29ycycgPT4gWw0KICAgICAgICAnXEFwcFxQcmVwcm9jZXNzb3JcTWFpbnRlbmFuY2UnLA0KICAgICAgICBbJ1xBcHBcUHJlcHJvY2Vzc29yXERlY3J5cHRSb3V0ZScsICdQT1NUJ10sDQogICAgICAgICdcQXBwXFByZXByb2Nlc3NvclxBY2Nlc3NDb250cm9sJywNCiAgICBdLA0KDQogICAgJ3Bvc3Rwcm9jZXNzb3JzJyA9PiBbICAgICAgDQogICAgXSwNCiAgDQoNCiAgICAvKiBkZWJ1Z2dpbmc6IHNldCB0aGlzIHRvIHRydWUgdG8gaGF2ZSBkZXRhaWxlZCBlcnJvciBtZXNzYWdlcyAqLw0KICAgICdkZWJ1ZycgPT4gQ29uZmlnOjplbnYoJ2RlYnVnJywgZmFsc2UpLA0KDQogICAgLyogbWFpbnRlbmFuY2UgbW9kZT8gKi8NCiAgICAnbWFpbnRlbmFuY2UnID0+IENvbmZpZzo6ZW52KCdtYWludGVuYW5jZScsIGZhbHNlKSwNCg0KICAgICdhc3NldHMnID0+IFsNCiAgICAgICAgJ2NzcycgPT4gJ2Fzc2V0cy9jc3MvJywNCiAgICAgICAgJ2pzJyA9PiAnYXNzZXRzL2pzLycsDQogICAgICAgICdpbWcnID0+ICdhc3NldHMvaW1hZ2VzLycsDQogICAgICAgICdmb250cycgPT4gJ2Fzc2V0cy9mb250LycsDQogICAgICAgICd2ZW5kb3InID0+ICdhc3NldHMvdmVuZG9ycy8nDQogICAgXSwNCg0KICAgIC8qIGJhc2UgdXJsIHRvIHRoZSB3ZWJzaXRlLCBpdCB3aWxsIGJlIGdhdGhlcmVkIGZyb20gLmVudiBidXQgaW4gcHJvZHVjdGlvbiB0aGlzDQogICAgdmFyaWFibGUgbXVzdCBiZSBzZXQgdG8gZmluYWwgdXJsICovDQogICAgJ3VybCcgPT4gQ29uZmlnOjplbnYoJ3VybCcsICdodHRwOi8vbG9jYWxob3N0JyksDQoNCiAgICAvKiByZWxheCByb3V0ZSAqLw0KICAgICdyZWxheF9yb3V0ZScgPT4gdHJ1ZSwNCg0KICAgIC8qIGZvcmNlIGh0dHBzICovDQogICAgJ2ZvcmNlX2h0dHBzJyA9PiB0cnVlLA0KDQogICAgLyogaGFzaGluZzogc2V0IHRoZSBrZXkgZm9yIGhhc2ggZ2VuZXJhdGlvbiBhbmQgbWV0aG9kICovDQogICAgJ2VuY19rZXknID0+IENvbmZpZzo6ZW52KCdlbmNfa2V5JywgJ19wMTM0czNfY2g0bmczXzd0MTVfazN5XycpLA0KICAgIA0KICAgICdlbmNfbWV0aG9kJyA9PiBDb25maWc6OmVudignZW5jX21ldGhvZCcsICdiZi1vZmInKSwNCg0KICAgIC8qIG1hbmFnZWQgd2Vic2l0ZSBwYXRoOiBpZiB0aGlzIGFwcCBpcyBhbmQgbWFuYWdlciBmb3IgYW5vdGhlciB3ZWJzaXRlIGFuZCB5b3UNCiAgICB0aGluayB5b3UnbGwgbmVlZCBpdHMgVVJMLCBwdXQgaXQgaGVyZSAqLyANCiAgICAvLyAnd2Vic2l0ZV9wYXRoJyA9PiBDb25maWc6OmVudignd2Vic2l0ZV9wYXRoJyksIA0KIA0KICAgIC8qIG1hbmFnZWQgd2Vic2l0ZSBhc3NldHMgcGF0aCAqLw0KICAgICd3ZWJzaXRlX2Fzc2V0cycgPT4gWw0KICAgICAgICAnY3NzJyA9PiAnY3NzLycsDQogICAgICAgICdqcycgPT4gJ2pzLycsDQogICAgICAgICdpbWcnID0+ICdpbWFnZXMvJywNCiAgICBdLA0KDQogICAgLyoqDQogICAgICogRGF0YWJhc2UgY29ubmVjdGlvbnMNCiAgICAgKiBhcHAgd2lsbCB1c2UgZGF0YWJhc2UgY29ubmVjdGlvbi4gUHV0IGZhbHNlIG9yIHJlbW92ZSB0byBub3QgDQogICAgICogdXNlIGFueSBkYXRhYmFzZSBjb25uZWN0aW9uLiBZb3UgY2FuIGFsc28gaW5kaWNhdGUgcHNyLTQgcm91dGUNCiAgICAgKiB0byB5b3VyIG93biBpbXBsZW1lbnRhdGlvbiBvZiBBZGFwdG9yIGlmIG5vdCBteXNxbGkgb3IgcG9zdGdyZXMgDQogICAgICovDQogICAgJ2Nvbm5lY3Rpb25zJyA9PiBbDQogICAgICAgICdteWRiJyA9PiBbDQogICAgICAgICAgICAnZHJpdmVyJyA9PiBDb25maWc6OmVudignZGJfZHJpdmVyJywgJ215c3FsJyksDQogICAgICAgICAgICAncG9ydCcgPT4gQ29uZmlnOjplbnYoJ2RiX3BvcnQnLCAzMzA2KSwNCiAgICAgICAgICAgICdob3N0JyA9PiBDb25maWc6OmVudignZGJfaG9zdCcsICdsb2NhbGhvc3QnKSwNCiAgICAgICAgICAgICd1c2VyJyA9PiBDb25maWc6OmVudignZGJfdXNlcicsICdyb290JyksDQogICAgICAgICAgICAncHdkJyA9PiBDb25maWc6OmVudignZGJfcGFzcycsICdyb290JyksDQogICAgICAgICAgICAnZGInID0+IENvbmZpZzo6ZW52KCdkYl9kYicsICdteV9kYicpLA0KICAgICAgICBdDQogICAgXSwNCiAgICAvKioNCiAgICAgKiBEZWZhdWx0IGNvbm5lY3Rpb24gd2hlbiBubyBzcGVjaWZpZWQgKGFsc28gdXNlZCBmb3Igc3RhcnQpDQogICAgICovDQogICAgJ2RlZmF1bHRfY29ubmVjdGlvbicgPT4gJ215ZGInLA0KDQogICAgLyoqDQogICAgICogR3VhcmRzIGFyZSB0aGUgaW5zdGFuY2VzIHRoYXQgYXV0aGVudGljYXRlIG9yIGF1dGhvcml6ZQ0KICAgICAqIGEgcmVxdWVzdA0KICAgICAqLw0KICAgICdndWFyZHMnID0+IFsNCiAgICAgICAnYWRtaW4nLA0KICAgICAgICdhcGknDQogICAgXSwNCg0KICAgIC8qKg0KICAgICAqIERlZmF1bHQgZ3VhcmQgd2hlbiBjb250cm9sbGVyIGRvZXNuJ3QgZGVzaWduYXRlIG9uZQ0KICAgICAqLw0KICAgICdkZWZhdWx0X2d1YXJkJyA9PiAnYWRtaW4nLA0KDQogICAgLyoqDQogICAgICogQXV0aGVudGljYXRpb24gaXMgdGhlIG1ldGhvZCB0byB2ZXJpZnkgYW4gaWRlbnRpdHkuIA0KICAgICAqIEVhY2ggZ3VhcmQgbXVzdCBpbXBsZW1lbnQgaXRzIG93biB3YXkgdG8gbWFrZSBhdXRoZW50aWNhdGlvbi4NCiAgICAgKiBJZiBub3QgbWV0aG9kIGlzIGZvdW5kIHRoZSByZXF1ZXN0IHdpbGwgYmUgZGVuaWVkIGJ5IGRlZmF1bHQNCiAgICAgKi8NCiAgICAnYXV0aGVudGljYXRpb24nID0+IFsNCiAgICAgICAgJ2FkbWluJywNCiAgICAgICAgJ2FwaScNCiAgICBdLA0KDQogICAgLyoqDQogICAgICogQXV0b3JpemF0aW9uIGlzIHRoZSBtZXRob2QgdG8gY2hlY2sgaWYgdXNlciBjYW4gYWNjZXNzDQogICAgICogYSByZXNvdXJjZS4NCiAgICAgKi8gICAgDQogICAgJ2F1dG9yaXphdGlvbicgPT4gWw0KICAgICAgICAnYWRtaW4nID0+IFsNCiAgICAgICAgICAgICdtZXRob2QnID0+ICdzZXNzaW9uJywNCiAgICAgICAgICAgICdsb29rX2ZvcicgPT4gWydpc19hZG1pbicsIHRydWVdDQogICAgICAgICAgICBdDQogICAgXSwNCl07DQo=',
        'ZnVuY3Rpb25zLnBocA==$YXBwL0NvbmZpZw==$PD9waHAgDQovKioNCiAqIFRoZSBwdXJwb3NlIG9mIHRoaXMgZmlsZSBpcyB0byBtYWtlIGdsb2JhbCBmdW5jdGlvbnMNCiAqIHRvIGJlIGNhbGxlZCB3aXRob3V0IHdyaXRpbmcgZW50aXJlIG5hbWVzcGFjZXMgb3IgbWFraW5nDQogKiBpbnZvY2F0aW9ucy4gVGhpcyBpcyB2ZXJ5IHVzZWZ1bCB0byBmdW5jdGlvbnMgdGhhciBhcmUNCiAqIGhlbHBlcnMgYW5kIGdldHRlcnMgb2YgZGF0YSB0aGF0IGFyZSB1c2VkIHZlcnkgb2Z0ZW4uDQogKiANCiAqIFRoZSBnbG9iYWwgY29uc3RydWN0b3Igd2lsbCB0YWtlIGNhcmUgb2YgeW91ciBjYWxsLCBkZXRlcm1pbmluZw0KICogaWYgeW91ciBtZXRob2QgaXMgc3RhdGljIG9yIG5vdCBhbmQgcmV0cmlldmluZyB0aGUNCiAqIHBhcmFtZXRlcnMgbmVlZGVkLiBJdCB3aWxsIG1ha2UgdGhlIGZ1bmN0aW9uIG9uIHRoZSBmbHkNCiAqIGZvciB5b3UuDQogKiANCiAqIEZvciBzZWN1cml0eSByZWFzb25zIHdlJ2xsIG5vdCBhbGxvdyB0aGUgcmVnaXN0cmF0aW9uDQogKiBvZiBjYWxsYmFjayBmdW5jdGlvbnMgaGVyZS4gQWxsIGNhbGxzIG11c3QgZ28gdG8gYSBtZXRob2QNCiAqIGluIGEgbmFtZXNwYWNlZCBjbGFzcy4NCiAqIA0KICovDQoNCnJldHVybiBbDQogICAgJ2FwcF9wYXRoJyA9PiAnXEphbnNzZW5cQXBwQGFwcFBhdGgnLA0KICAgICd1cmwnID0+ICdcSmFuc3NlblxBcHBAdXJsJywNCiAgICAnYXNzZXRzJyA9PiAnXEphbnNzZW5cQXBwQGFzc2V0cycsDQogICAgDQogICAgJ2ZpbGUnID0+ICdcSmFuc3NlblxBcHBAZmlsZVJlc3BvbnNlJywNCiAgICAncmVxdWVzdCcgPT4gJ1xKYW5zc2VuXEFwcEBnZXRSZXF1ZXN0JywNCiAgICANCiAgICAnZW5naW5lX2NvbmZpZycgPT4gJ1xKYW5zc2VuXEFwcEBnZXRDb25maWcnLA0KICAgICdjdXJyZW50X2hlYWRlcicgPT4gJ1xKYW5zc2VuXEFwcEBnZXRDdXJyZW50SGVhZGVyJywNCg0KICAgIC8qDQogICAgJ3dlYnNpdGVfYXNzZXRzJyA9PiAnXEFwcFxDb250cm9sbGVyXFdlYnNpdGVDb250cm9sbGVyQHdlYnNpdGVBc3NldHMnLA0KICAgICd3ZWJzaXRlX3BhdGgnID0+ICdcQXBwXENvbnRyb2xsZXJcV2Vic2l0ZUNvbnRyb2xsZXJAd2Vic2l0ZVBhdGgnLA0KICAgICovDQoNCiAgICBdOw==',
        'cm91dGVzLnBocA==$YXBwL0NvbmZpZw==$PD9waHAgDQoNCi8qKg0KICogDQogKiBGaWxsIHRoZSBhcnJheSB3aXRoIHJvdXRlLCBkZXN0aW5hdGlvbiB0aGF0IHdpbGwgYmUgcHJvY2Vzc2VkIGFuZCBvcHRpb25hbGx5IHBhcmFtcw0KICogDQogKiBUSElTIElTIE9OTFkgRk9SIEdFVCBSRVFVRVNUUw0KICogDQogKiBBcnJheSBNVVNUIEJFOg0KICogUmVnZXh8bGl0ZXJhbDogdGhpcyB3aWxsIGJlIGNvbXBhcmVkIHRvIHJlcXVlc3QgYW5kIGZpcnN0IG1hdGNoIHdpbGwgYmUgcmV0dXJuZWQNCiAqIENvbnRyb2xsZXJ8VGVtcGxhdGVfZmlsZTogVGhpcyB3aWxsIHByb2Nlc3MgdGhlIHJlcXVlc3QsIGlmIGEgY29udHJvbGxlciBpcyBwYXNzZWQgaXQNCiAqIHdpbGwgYmUgaW52b2tlZCwgaWYgYSBmaWxlIGlzIHBhc3NlZCB0aGUgcGF0aCB3aWxsIGJlIHNlYXJjaGVkIGluIHRlbXBsYXRlcyBmb2xkZXIsIGxvYWRlZA0KICogYW5kIHJldHVybmVkLg0KICogUGFyYW1ldGVyOiBJZiB5b3VyIHJlZ2V4IGhhcyBjYXB0dXJlIHZhcmlhYmxlcywgdGhpcyB3aWxsIGJlIG5hbWVkIHdpdGggdGhpcyBsaXRlcmFscw0KICogYW5kIHBhc3NlZCB0byBjb250cm9sbGVyIChpcyB1c2VkKSBvciBzYXZlZCBpbiBSZXF1ZXN0IHBhcmFtZXRlcnMgdG8gYmUgdXNlZCBpbiB5b3VyDQogKiBhcHAgbm9ybWFsbHkuIFRoaXMgcGFyYW1ldGVycyBhcmUgcHJvY2Vzc2VkIGluIG9yZGVyIGFuZCBQT1NUIG92ZXJ3cml0ZSBHRVQgcGFyYW1ldGVycy4NCiAqIA0KICoqLyANCg0KcmV0dXJuIFsNCg0KICAgICAgICBbJ3BhdGgnID0+ICcvZHluanMvbG9naW4nLCANCiAgICAgICAgJ3Jlc29sdmVyJyA9PiAnXEFwcFxDb250cm9sbGVyXFNjcmlwdENvbnRyb2xsZXJAZ2V0TG9naW5TY3JpcHQnLCANCiAgICAgICAgJ2d1YXJkJyA9PiAnbm9ib2R5J10sIA0KICAgICAgICANCiAgICAgICAgWydwYXRoJyA9PicvJywgDQogICAgICAgICdyZXNvbHZlcicgPT4gJ3dlbGNvbWUucGhwJywgDQogICAgICAgICdndWFyZCcgPT4gJ25vYm9keSddLA0KICAgIA0KXTs=',
        'SG9tZUNvbnRyb2xsZXIucGhw$YXBwL0NvbnRyb2xsZXI=$PD9waHAgDQoNCm5hbWVzcGFjZSBBcHBcQ29udHJvbGxlcjsNCg0KdXNlIEphbnNzZW5cRW5naW5lXENvbnRyb2xsZXI7DQp1c2UgSmFuc3NlblxFbmdpbmVcUmVxdWVzdDsNCg0KY2xhc3MgSG9tZUNvbnRyb2xsZXIgZXh0ZW5kcyBDb250cm9sbGVyDQp7DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gd2VsY29tZSgpDQogICAgew0KICAgICAgICByZXR1cm4gIkhlbGxvIHVzZXIhIjsNCiAgICB9DQoNCn0=',
        'QWNjZXNzQ29udHJvbC5waHA=$YXBwL1ByZXByb2Nlc3Nvcg==$PD9waHAgCgpuYW1lc3BhY2UgQXBwXFByZXByb2Nlc3NvcjsKCi8vdXNlIEphbnNzZW5cRW5naW5lXEZhY3Rvcnk7CnVzZSBKYW5zc2VuXEVuZ2luZVxQcmVwcm9jZXNzb3I7CnVzZSBKYW5zc2VuXEVuZ2luZVxSZXF1ZXN0Owp1c2UgSmFuc3NlblxFbmdpbmVcUm91dGU7CnVzZSBKYW5zc2VuXEhlbHBlcnNcRXhjZXB0aW9uOwp1c2UgSmFuc3NlblxIZWxwZXJzXEd1YXJkOwp1c2UgSmFuc3NlblxIZWxwZXJzXFJlc3BvbnNlXEVycm9yUmVzcG9uc2U7CnVzZSBKYW5zc2VuXEhlbHBlcnNcQXV0aDsKCmNsYXNzIEFjY2Vzc0NvbnRyb2wgZXh0ZW5kcyBQcmVwcm9jZXNzb3IKewoKICAgIHB1YmxpYyBmdW5jdGlvbiBoYW5kbGUoUmVxdWVzdCAkcmVxdWVzdCkKICAgIHsKICAgICAgICAvLyBpZiByZXF1ZXN0IG1ldGhvZCBpcyBnZXQgd2UgZmluZCBmb3IgYSBhdXRob3JpemF0aW9uIGluIGd1YXJkCiAgICAgICAgLy8gaWYgcG9zdCB3ZSBjaGVjayB0aGUgdmFsaWRhdG9yIHRvIGNoZWNrIHdoYXQgZ3VhcmRzIGFyZSBlbmFibGVkCiAgICAgICAgJHJtID0gJHJlcXVlc3QtPm1ldGhvZCgpOwogICAgICAgIGlmKCRybSA9PSAnR0VUJyl7CiAgICAgICAgICAgICRwYXRoID0gJHJlcXVlc3QtPmdldFBhdGgoKTsKICAgICAgICAgICAgJHJvdXRlID0gUm91dGU6OmdldEJ5UGF0aCgkcGF0aCk7CiAgICAgICAgICAgICRndWFyZCA9IGVtcHR5KCRyb3V0ZVsnZ3VhcmQnXSk/ZW5naW5lX2NvbmZpZygnZGVmYXVsdF9ndWFyZCcpOiRyb3V0ZVsnZ3VhcmQnXTsKICAgICAgICAgICAgaWYoJGd1YXJkICE9PSAnbm9ib2R5Jyl7CiAgICAgICAgICAgICAgICByZXR1cm4gQXV0aDo6Z3VhcmQoJGd1YXJkKS0+YXV0aG9yaXplKCRyZXF1ZXN0KTsKICAgICAgICAgICAgfWVsc2UKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwoKICAgICAgICB9ZWxzZWlmIChpbl9hcnJheSgkcm0sIFsnUE9TVCcsJ1BVVCcsJ0RFTEVURSddKSl7CiAgICAgICAgICAgICR1YSA9ICRyZXF1ZXN0LT5nZXRVc2VyQWN0aW9uKCk7CiAgICAgICAgICAgICR2X25hbWUgPSAnXEFwcFxWYWxpZGF0b3JcXCcgLiB0cmFuc2Zvcm1fdG9fY2xhc3NfbmFtZSgkdWFbJ2NvbnRyb2xsZXInXSkgLiAnVmFsaWRhdG9yJzsKICAgICAgICAgICAgJHYgPSBuZXcgJHZfbmFtZTsKICAgICAgICAgICAgJGd1YXJkID0gR3VhcmQ6OnJlc29sdmUoJHYtPmd1YXJkKTsKICAgICAgICAgICAgLy8gYXMgZ3VhcmRzIGF1dGhvcml6ZSB0aGUgYWNjZXNzLCB3aXRoIG9ubHkgb25lIHRoYXQgYWxsb3dzIHRoZSBhY3Rpb24KICAgICAgICAgICAgLy8gaXQgd2lsbCBiZSBhbGxvd2VkCiAgICAgICAgICAgICRhdXRob3JpemVkID0gZmFsc2UgfHwgJHYtPmd1YXJkID09ICdub2JvZHknOwogICAgICAgICAgICBmb3JlYWNoKCRndWFyZCBhcyAkZykKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJGF1dGhvcml6ZWQgPSAkZy0+YXV0aG9yaXplKCRyZXF1ZXN0KTsKICAgICAgICAgICAgICAgIGlmKCRhdXRob3JpemVkKQogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmKCEkYXV0aG9yaXplZCkKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRXJyb3JSZXNwb25zZSgnUmVxdWVzdCBub3QgYWxsb3dlZCcsIDQwMyk7CiAgICAgICAgfWVsc2VpZigkcm0gPT0gJ09QVElPTlMnKXsKICAgICAgICAgICAgJGhlYWRlcnMgPSBbCiAgICAgICAgICAgICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luOiAqJywKICAgICAgICAgICAgICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzOiBQT1NULCBHRVQsIE9QVElPTlMnLAogICAgICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnM6IFgtUElOR09USEVSLCBDb250ZW50LVR5cGUnLAogICAgICAgICAgICAgICAgJ0FjY2Vzcy1Db250cm9sLU1heC1BZ2U6IDg2NDAwJwogICAgICAgICAgICBdOwogICAgICAgICAgICBmb3JlYWNoKCRoZWFkZXJzIGFzICRoKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBoZWFkZXIoJGgsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgfWVsc2UKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignUmVxdWVzdCBub3QgYWNjZXB0YWJsZScsIDQwNik7CiAgICAgICAgCiAgICAgICAgLy8gdGhpcyBmdW5jdGlvbiBtdXN0IHJldHVybiBhIGJvb2xlYW4KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFuZGxlRXJyb3IoKQogICAgewogICAgICAgIHJldHVybiByZWRpcmVjdCgnbG9naW4nKS0+d2l0aERhdGEoWydlcnJvcicgPT4gJ1lvdXIgc2Vzc2lvbiBoYXMgZW5kZWQuIExvZ2luIGFnYWluJ10pOwogICAgfQoKfQ==',
        'RGVjcnlwdFJvdXRlLnBocA==$YXBwL1ByZXByb2Nlc3Nvcg==$PD9waHAgCgpuYW1lc3BhY2UgQXBwXFByZXByb2Nlc3NvcjsKCnVzZSBKYW5zc2VuXEVuZ2luZVxQcmVwcm9jZXNzb3I7CnVzZSBKYW5zc2VuXEVuZ2luZVxSb3V0ZTsKdXNlIEphbnNzZW5cRW5naW5lXFJlcXVlc3Q7CnVzZSBKYW5zc2VuXEhlbHBlcnNcRXhjZXB0aW9uOwoKCmNsYXNzIERlY3J5cHRSb3V0ZSBleHRlbmRzIFByZXByb2Nlc3Nvcgp7CgogICAgcHVibGljIGZ1bmN0aW9uIGhhbmRsZShSZXF1ZXN0ICRyZXF1ZXN0KQogICAgewogICAgICAgICRyZXF1ZXN0ID0gbmV3IFJlcXVlc3Q7CiAgICAgICAgLy8gZ2V0IHRoZSBmdWxsIHBhdGggYW5kIGV4dHJhY3QgdGhlIHBheWxvYWQgdG8gZ2V0IHRoZSByb3V0ZQogICAgICAgICRwYXlsb2FkID0gJHJlcXVlc3QtPmdldFF1ZXJ5U3RyaW5nUGF5bG9hZCgpOwogICAgICAgIGlmICghJHBheWxvYWQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignSW52YWxpZCByZXF1ZXN0JywgNDAwKTsKICAgICAgICB9CiAgICAgICAgLy8gZGVjaXBoZXIgcm91dGUKICAgICAgICAkcm91dGUgPSBSb3V0ZTo6ZGVjcnlwdCgkcGF5bG9hZCk7CiAgICAgICAgLy8gbG9hZCB0aGUgY29ycmVjdCBjb250cm9sbGVyCiAgICAgICAgJGEgPSBleHBsb2RlKCcvJywgJHJvdXRlKTsKICAgICAgICBpZiAoIWlzX2FycmF5KCRhKSAmJiBjb3VudCgkYSkgPD0gMikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdJbnZhbGlkIHJlcXVlc3QnLCA0MDApOwogICAgICAgIH0KICAgICAgICAvL2F1dG9jYXBpdGFsaXplIGNvbnRyb2xsZXIgYW5kIG1ldGhvZAogICAgICAgIGZvcmVhY2goJGEgYXMgJiRtZW1iZXIpIHsKICAgICAgICAgICAgJG1lbWJlciA9IHVjZmlyc3Qoc3RydG9sb3dlcigkbWVtYmVyKSk7CiAgICAgICAgfQogICAgICAgIHVuc2V0KCRtZW1iZXIpOwoKICAgICAgICAvLyBjb3VudCB0aGUgcGF5bG9hZCBtZW1iZXJzCiAgICAgICAgJGkgPSBjb3VudCgkYSk7CiAgICAgICAgJGMgPSBhcnJheV9zbGljZSgkYSwgMCwgLTEpOwogICAgICAgICRkID0gaW1wbG9kZSgnXFwnLCAkYyk7CiAgICAgICAgJGQgPSBzdHJfcmVwbGFjZSgnLScsICdfJywgJGQpOwoKICAgICAgICAvLyBzYXZlIHRoZSBwYXRoIHRvIFJlcXVlc3Qgb2JqZWN0CiAgICAgICAgJHJlcXVlc3QtPnNldFVzZXJBY3Rpb24oJGQsICRhWyRpLTFdKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFuZGxlRXJyb3IoKQogICAgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCn0=',
        'TWFpbnRlbmFuY2UucGhw$YXBwL1ByZXByb2Nlc3Nvcg==$PD9waHAgDQoNCm5hbWVzcGFjZSBBcHBcUHJlcHJvY2Vzc29yOw0KDQp1c2UgSmFuc3NlblxFbmdpbmVcUHJlcHJvY2Vzc29yOw0KdXNlIEphbnNzZW5cRW5naW5lXFJlcXVlc3Q7DQp1c2UgSmFuc3NlblxFbmdpbmVcQ29uZmlnOw0KDQpjbGFzcyBNYWludGVuYW5jZSBleHRlbmRzIFByZXByb2Nlc3Nvcg0Kew0KDQogICAgcHVibGljIGZ1bmN0aW9uIGhhbmRsZShSZXF1ZXN0ICRyZXF1ZXN0KQ0KICAgIHsNCiAgICAgICAgaWYoQ29uZmlnOjpnZXQoJ21haW50ZW5hbmNlJykgPT0gJ3RydWUnKXsNCiAgICAgICAgICAgIC8vIG1ha2UgYSByZXNwb25zZSB0byBoYW5kbGUgdGhlIG1haW50ZW5hbmNlDQogICAgICAgICAgICAkciA9IG5ldyBcSmFuc3NlblxIZWxwZXJzXFJlc3BvbnNlXFJhd1Jlc3BvbnNlOw0KICAgICAgICAgICAgJHItPnNldENvbnRlbnQoJ0VzdGFtb3MgZW4gbWFudGVuaW1pZW50byEnKTsNCiAgICAgICAgICAgIHJldHVybiAkcjsNCiAgICAgICAgfWVsc2UNCiAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgIH0NCg0KICAgIHB1YmxpYyBmdW5jdGlvbiBoYW5kbGVFcnJvcigpDQogICAgew0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfQ0KDQp9',
        'U2Vzc2lvblRpbWVvdXQucGhw$YXBwL1ByZXByb2Nlc3Nvcg==$PD9waHAgDQoNCm5hbWVzcGFjZSBBcHBcUHJlcHJvY2Vzc29yOw0KDQp1c2UgSmFuc3NlblxFbmdpbmVcUHJlcHJvY2Vzc29yOw0KdXNlIEphbnNzZW5cRW5naW5lXFJlcXVlc3Q7DQoNCmNsYXNzIFNlc3Npb25UaW1lb3V0IGV4dGVuZHMgUHJlcHJvY2Vzc29yDQp7DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFuZGxlKFJlcXVlc3QgJHJlcXVlc3QpDQogICAgew0KICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICB9DQoNCiAgICBwdWJsaWMgZnVuY3Rpb24gaGFuZGxlRXJyb3IoKQ0KICAgIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCg0KfQ==',
    ],
];

$base_path = __DIR__ . '/../';

if ($argc == 1)
    dieWithMessage(showArgumentList());

switch (strtolower($argv[1])){
    case 'init':
        echo 'init';
        foreach($files as $section=>$encfile){
            if(is_array($encfile)){
                foreach($encfile as $eencfile){
                    $parts = getParts($eencfile);		
                    putContents($parts);
                }
            }else{
                $parts = getParts($encfile);
                putContents($parts);	
            }
        }
        break;
    case 'prepare':
        echo "make model";
        // param 2 should be the model name and optionally 4th the table name if 3rd is -t
        $mn = $argv[2];

        if(empty($mn))
            dieWithMessage('Model name is required!');

        $tn = false;
        if(isset($argv[3]) && strtolower($argv[3]) == '-t'){
            if(!empty($argv[4])){
                $tn = $argv[4];
            }else
                dieWithMessage('if you set -t must indicate table name');
        }
        $text = createModel($mn, $tn);
        $m_path = 'app/Model';
        createDir($base_path, $m_path);
        $dest = $base_path . $m_path . '/' . ucfirst($mn) . '.php';
        file_put_contents($dest, $text);
        break;
        
    default:
        dieWithMessage(showArgumentList());

}

dieWithMessage('Done!');

function getParts($encoded){
    $a = explode('$', $encoded, 3);
    $filename = base64_decode($a[0]);
    $path = base64_decode($a[1]);
    $content = base64_decode($a[2]);

    return compact('filename', 'path', 'content');
}

function putContents($parts){
	
	global $base_path, $DS;
	
    $d = createDir($base_path, $parts['path']);
	$intended_file = $d . $DS . $parts['filename'];
    file_put_contents($intended_file, $parts['content']);
	echo 'created ' . $intended_file . PHP_EOL;
}

function createDir($base_path, $new_path)
{
    global $DS;

    $parts = explode('/', $new_path);
    $cpart = '';
	//$intended_dir = $base_path;
    foreach($parts as $part){
		if(empty($part))
			continue;
        $cpart .= $DS . $part;
        if(!is_dir($base_path . $cpart))
            mkdir($base_path . $cpart);
    }
    return $base_path . $cpart;
}

function showArgumentList(){
    $ret = "Hey! You forgot to put the action you want to do!" . PHP_EOL . PHP_EOL .
    "What do you want to do? (use a command from the list)" . PHP_EOL .  PHP_EOL .
    "init: make scaffolding to start your app" . PHP_EOL . 
    "prepare [-t table-name]: make a model with given name. Add optional -t parameter to use your own table name" . PHP_EOL ;
    return $ret;
}

function makeClassName($name){
    return ucfirst($name);
}

function dieWithMessage($message)
{
    die(PHP_EOL . $message . PHP_EOL);
}
